{% extends "base.html" %}
{% block title %}Bet Assist All Games{% endblock %}
{% block content %}
    <h1>
        <img class="main_logo" src="{{ url_for('static', filename=logo) }}">
    </h1>
    <div>
        <div class="form-check form-check-inline" style="padding-right: 10%">
            <label class="switch">
                <input type="checkbox" role="switch" id="checkOver2">
                <span class="slider round"></span>
            </label>
            <label class="form-check-label" for="checkBTTS">Over 2.5</label>
        </div>
        <div class="form-check form-check-inline" style="padding-left: 10%">
            <label class="switch">
                <input type="checkbox" role="switch" id="checkBTTS">
                <span class="slider round"></span>
            </label>
            <label class="form-check-label" for="checkBTTS">BTTS</label>
        </div>
    </div>
    {% for result in res %}
    <div class="card" id={%
                    if res[result]['btts'] and res[result]['over2.5'] %}0{%
                    elif res[result]['over2.5']%}1{%
                    elif res[result]['btts']%}2{%
                    else %}9{% endif %}>
        <div class="card-body">
            <!-- Team standings, names and total goal average -->
            <div class="date-time">
                <p>
                    <span class="date">üìÖ {{ res[result]['date'] }}</span>
                    <span class="time">‚è∞ {{ res[result]['time'] }}</span>
                </p>
            </div>
            <div class="fixture-teams">
                <p class="goals">
                    {% if standings.get(res[result]['home_team']) != None %}
                        ({{ standings.get( res[result]['home_team'] ) }})
                    {% endif %}
                        {{ res[result]['home_team'] }} vs {{ res[result]['away_team'] }}
                    {% if standings.get(res[result]['home_team']) != None %}
                        ({{ standings.get( res[result]['away_team'] ) }})
                    {% endif %}
                </p>
                <br>
            </div>
            <!-- Goals scored, conceded and results for the home team-->
            <p class="goals{% if res[result]['total_average_goals'] > '3.25' %}-g{% endif %}">
                Combined Goal Average: {{ res[result]['total_average_goals'] }}
            </p>
            <div>
                <div class="game-results">
                    <p class="goals{% if res[result]['home_average_goals'] > '3' %}-g{% endif %}">
                        Average Goals: {{ res[result]['home_average_goals'] }}
                    </p>
                    {% for item in res[result]['home_results']  %}
                        {% for game in item %}
                            <p class="{{ game }}">{{ game }}</p>
                        {% endfor %}
                    {% endfor %}
                    <p class="goals{% if res[result]['home_goals_scored'] > '1.5' %}-g{% endif %}">
                        Scored: {{res[result]['home_goals_scored'] }}
                    </p>
                    <p class="goals{% if res[result]['home_goals_conceded'] > '1.5' %}-g{% endif %}">
                        Conceded: {{res[result]['home_goals_conceded'] }}
                    </p>
                </div>
                <div class="fixture-teams">
                    <p> vs </p>
                    <br><br>
                </div>
                <!-- Goals scored, conceded and results for the away team-->
                <div class="game-results">
                    <p class="goals{% if res[result]['away_average_goals'] > '3' %}-g{% endif %}">
                        Average Goals: {{ res[result]['away_average_goals'] }}
                    </p>
                    {% for item in res[result]['away_results']  %}
                        {% for game in item %}
                            <p class="{{ game }}">{{ game }}</p>
                        {% endfor %}
                    {% endfor %}
                    <p class="goals{% if res[result]['away_goals_scored'] > '1.5' %}-g{% endif %}">
                        Scored: {{res[result]['away_goals_scored'] }}
                    </p>
                    <p class="goals{% if res[result]['away_goals_conceded'] > '1.5' %}-g{% endif %}">
                        Conceded: {{res[result]['away_goals_conceded'] }}
                    </p>
                </div>
            </div>
        </div>
        <div class="outcome-outer">
            <div class="outcome{% if res[result]['btts'] %}-g{% endif %}" style="padding-right: 15%">BTTS</div>
            <div class="outcome{% if res[result]['over2.5'] %}-g{% endif %}" style="padding-left: 15%">OVER 2.5</div>
        </div>
    </div>
    {% endfor %}
    <div class="modal fade" id="myOutput" role="dialog">
        <div class="modal-dialog modal-lg">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-body">
              <div id="fs-standings">
              </div>
                <script>
                    (function (w,d,s,o,f,js,fjs)
                        { w['fsStandingsEmbed']=o;w[o] = w[o] || function () { (w[o].q = w[o].q || []).push(arguments) };
                            js = d.createElement(s), fjs = d.getElementsByTagName(s)[0];
                            js.id = o;
                            js.src = f;
                            js.async = 1;
                            fjs.parentNode.insertBefore(js, fjs);
                        } (window, document, 'script', 'mw', 'https://cdn.footystats.org/embeds/standings.js'));
                    mw('params', { leagueID: {{ table_id }} });
                </script>
                  <script>
                    const btts = document.querySelector('#checkBTTS');
                    const over2 = document.querySelector('#checkOver2')
                    const card = document.getElementsByClassName("card");

                    btts.addEventListener("click", function() {
                        checkBoth();
                    });

                    over2.addEventListener("click", function () {
                        checkBoth();
                    });

                    //TODO:  work on algorithm to check card[i] and card[i + 1] to give better results
                    function checkBoth() {
                        for(i = 0; i < card.length; i++) {
                            if (btts.checked && over2.checked) {
                                if(card[i].id === "0"){
                                    card[i].style.display = ""
                                } else {
                                    card[i].style.display = "none";
                                }
                            } else if(btts.checked){
                                if(card[i].id === "2" || card[i].id === "0"){
                                    card[i].style.display = ""
                                } else {
                                    card[i].style.display = "none";
                                }
                            } else if(over2.checked) {
                                if(card[i].id === "1" || card[i].id === "0"){
                                    card[i].style.display = ""
                                } else {
                                    card[i].style.display = "none";
                                }
                            } else {
                                card[i].style.display = "";
                            }
                        }
                    }
                </script>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>

    {% if table_id != 0000 %}
        <button type="button" id="table_button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#myOutput">League Table</button>
    {% endif %}

{% endblock %}
